<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rogues of Might and Magic - Tactical Combat</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- units.js provides UNIT_TYPES globally -->
    <script src="units.js"></script>
</head>
<body>
    <h1>âš”ï¸ Rogues of Might and Magic ğŸ›¡ï¸</h1>
    
    <!-- Initiative Bar (HOMM5 style) -->
    <div id="initiative-bar">
        <div id="initiative-queue"></div>
    </div>
    
    <div id="game-container"></div>
    
    <!-- Placement Bar (shown during placement phase, above UI panel) -->
    <div id="placement-bar" class="hidden">
        <div class="placement-title">ğŸ“ Unit Placement</div>
        <div class="placement-hint">Click left 2 columns to place units</div>
        <div class="action-divider"></div>
        <div id="placement-info">
            <span id="current-placement-unit">-</span> (<span id="placement-remaining">0</span> left)
        </div>
        <button id="confirm-placement" class="spell-button" onclick="gameScene.confirmPlacement()" disabled>
            Start Battle
        </button>
    </div>
    
    <!-- UI Panel -->
    <div id="ui-panel">
        <div class="turn-indicator">
            <strong>Turn:</strong> <span id="current-turn">Player</span>
        </div>
        <div class="mana-display" id="mana-display">
            ğŸ’§ Mana: <span id="mana-current">100</span>/<span id="mana-max">100</span>
        </div>
        <div class="action-divider"></div>
        <div class="action-section">
            <strong style="color: #A68966;">Hero:</strong>
            <button id="spellbook-btn" class="spell-button" onclick="gameScene.openSpellBook()">
                ğŸ“– Spell Book
            </button>
        </div>
        <div class="action-divider"></div>
        <div class="action-section">
            <button class="spell-button" onclick="gameScene.endTurn()">
                â¹ï¸ End Turn
            </button>
        </div>
    </div>
    
    <!-- Unit Info Panel (positioned on right side) -->
    <div class="unit-info" id="unit-info">
        <em>Select a unit to view details</em>
    </div>

    <!-- Pre-game Army Selection -->
    <div id="pregame-screen" class="victory-screen">
        <h2 style="color: #A68966;">âš”ï¸ Army Selection âš”ï¸</h2>
        <p style="color: #E3D5B8; margin-bottom: 10px; font-size: 18px;">Spend your points wisely!</p>
        <div class="mana-display" style="margin-bottom: 20px;">
            ğŸ’° Points: <span id="points-remaining">1000</span>/1000
        </div>
        
        <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; max-width: 1200px;">
            <!-- Basic Units (200-400 points) -->
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">âš”ï¸</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Knight</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 100 | DMG: 25<br>MOV: 4 | INIT: 12
                </div>
                <div style="color: #8B7355; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    ğŸ›¡ï¸ -50% ranged dmg
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 200</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('KNIGHT', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-KNIGHT" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('KNIGHT', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ¹</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Archer</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 60 | DMG: 35<br>MOV: 2 | RNG: 6
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 300</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('ARCHER', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-ARCHER" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('ARCHER', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ§™</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Wizard</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 40 | DMG: 45<br>MOV: 2 | RNG: 4
                </div>
                <div style="color: #4A729E; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    ğŸ”® +1 Mana/turn
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 400</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('WIZARD', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-WIZARD" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('WIZARD', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>

            <!-- Specialist Units (500 points) -->
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">âœï¸</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Cleric</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 80 | DMG: 15<br>MOV: 2 | RNG: 4
                </div>
                <div style="color: #6B8B5B; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    ğŸ’š +50% healing
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 500</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('CLERIC', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-CLERIC" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('CLERIC', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ—¡ï¸</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Rogue</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 55 | DMG: 40<br>MOV: 8 | INIT: 16
                </div>
                <div style="color: #6B5B8B; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    ğŸ‘¤ Hit & Run
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 500</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('ROGUE', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-ROGUE" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('ROGUE', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>

            <!-- Elite Units (800 points) -->
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ›¡ï¸</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Paladin</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 150 | DMG: 50<br>MOV: 4 | INIT: 9
                </div>
                <div style="color: #8B7355; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    ğŸ›¡ï¸ -50% ranged, +50% heal
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 800</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('PALADIN', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-PALADIN" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('PALADIN', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ¯</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Ranger</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 70 | DMG: 50<br>MOV: 2 | RNG: 10
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 800</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('RANGER', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-RANGER" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('RANGER', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸª“</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Berserker</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 90 | DMG: 50<br>MOV: 4 | INIT: 11
                </div>
                <div style="color: #9E5B4A; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    âš”ï¸ Reckless, Bloodlust
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 800</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('BERSERKER', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-BERSERKER" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('BERSERKER', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
            
            <div class="spell-card" style="min-width: 140px; max-width: 180px;">
                <div style="font-size: 36px; margin-bottom: 8px;">ğŸ”®</div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 3px; font-size: 14px;">Sorcerer</div>
                <div style="font-size: 11px; color: #B8A896; margin-bottom: 8px;">
                    HP: 50 | DMG: 55<br>MOV: 2 | RNG: 4
                </div>
                <div style="color: #6B5B8B; font-size: 10px; margin-bottom: 8px; font-style: italic;">
                    âœ¨ +50% spell dmg
                </div>
                <div style="color: #A68966; font-weight: bold; margin-bottom: 8px; font-size: 14px;">ğŸ’° 800</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <button class="spell-button" onclick="gameScene.updateUnitCount('SORCERER', -1)" style="padding: 4px 12px;">-</button>
                    <span id="count-SORCERER" style="font-size: 18px; font-weight: bold; min-width: 25px; color: #A68966;">0</span>
                    <button class="spell-button" onclick="gameScene.updateUnitCount('SORCERER', 1)" style="padding: 4px 12px;">+</button>
                </div>
            </div>
        </div>
        
        <button id="confirm-army" class="spellbook-close" onclick="gameScene.confirmArmySelection()" disabled>
            Confirm Army (0 units)
        </button>
    </div>

    <!-- Victory Screen -->
    <div id="victory-screen" class="victory-screen hidden">
        <h2 id="victory-text">ğŸ‰ Victory! ğŸ‰</h2>
        <p id="victory-subtitle" style="color: #E3D5B8; margin-bottom: 20px; font-size: 18px;">Choose your rewards for the next battle:</p>
        
        <div id="rewards-container" style="display: flex; flex-direction: column; gap: 20px; align-items: center; max-width: 1200px; width: 100%;">
            <div style="width: 100%;">
                <h3 style="color: #A68966; text-align: center; margin-bottom: 10px;">âš”ï¸ Recruit a New Unit</h3>
                <div id="reward-units" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;"></div>
            </div>
            
            <div style="width: 100%;">
                <h3 style="color: #8B9A6B; text-align: center; margin-bottom: 10px;">ğŸ’ª Buff an Existing Unit</h3>
                <div id="reward-buffs" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;"></div>
            </div>
            
            <div style="width: 100%;">
                <h3 style="color: #6B7A9A; text-align: center; margin-bottom: 10px;">ğŸ§™ Spell or Mana Enhancement</h3>
                <div id="reward-magic" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;"></div>
            </div>
        </div>
        
        <div id="defeat-message" style="display: none; text-align: center; padding: 30px;">
            <p style="color: #B8A896; font-size: 18px; margin-bottom: 20px;">Your army has fallen...</p>
            <p style="color: #8B7355; font-size: 14px; margin-bottom: 30px; font-style: italic;">Better luck next time, commander.</p>
            <button class="spell-button" onclick="location.reload()" style="font-size: 16px; padding: 12px 30px;">âš”ï¸ Try Again</button>
        </div>
        
        <button id="confirm-rewards" class="spellbook-close" style="margin-top: 30px;" onclick="gameScene.confirmRewards()" disabled>
            Confirm Choices (0/3)
        </button>
    </div>

    <!-- Magic Buffs Panel (moved to bottom left to avoid overlap with unit-info) -->
    <div id="magic-buffs-panel" style="position: fixed; bottom: 20px; left: 20px; background: #2D241E; border: 2px solid #A68966; border-radius: 4px; padding: 12px; min-width: 180px; max-width: 220px; color: #E3D5B8; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.6);">
        <div style="font-weight: bold; color: #A68966; margin-bottom: 8px; text-align: center; border-bottom: 1px solid #5D4E3E; padding-bottom: 5px;">
            ğŸ”® Magic Buffs
        </div>
        <div id="magic-buffs-list" style="font-size: 12px;">
            <div style="color: #8B7355; font-style: italic; text-align: center;">No active buffs</div>
        </div>
    </div>

    <!-- Spellbook Modal -->
    <div id="spellbook-modal" class="spellbook-modal hidden">
        <div class="spellbook-content">
            <div class="spellbook-header">
                <h2>ğŸ“– Spell Book</h2>
                <p style="color: #4A729E;">ğŸ’§ Mana: <span id="spellbook-mana">100</span>/<span id="spellbook-max-mana">100</span> (Regenerates +1 per turn)</p>
                <p style="color: #8B7355; font-size: 12px;">Click a spell to cast it</p>
            </div>
            <div class="spell-grid" id="spell-grid"></div>
            <button class="spellbook-close" onclick="gameScene.closeSpellBook()">Close</button>
        </div>
    </div>

    <!-- Main entry point as ES6 module -->
    <script type="module" src="src/main.js"></script>
</body>
</html>
